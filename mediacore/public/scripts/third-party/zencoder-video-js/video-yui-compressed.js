var videoJSPlayers=[];var VideoJS=new Class({initialize:function(b,a){this.video=$(b);this.video.controls=false;this.options={num:0,controlsBelow:false,controlsHiding:true,defaultVolume:0.85,flashVersion:9,linksHiding:true};if(typeof a=="object"){_V_.merge(this.options,a)}this.box=this.video.parentNode;this.flashFallback=this.getFlashFallback();this.linksFallback=this.getLinksFallback();if(VideoJS.browserSupportsVideo()||((this.flashFallback||VideoJS.isIE())&&this.flashVersionSupported())){this.hideLinksFallback()}if(VideoJS.browserSupportsVideo()){if(this.canPlaySource()==false){this.replaceWithFlash();return}}else{return}if(VideoJS.isIpad()){this.options.controlsBelow=true;this.options.controlsHiding=false}if(this.options.controlsBelow){_V_.addClass(this.box,"vjs-controls-below")}this.percentLoaded=0;this.buildPoster();this.showPoster();this.buildController();this.showController();this.video.addEventListener("loadeddata",this.onLoadedData.context(this),false);this.video.addEventListener("play",this.onPlay.context(this),false);this.video.addEventListener("pause",this.onPause.context(this),false);this.video.addEventListener("ended",this.onEnded.context(this),false);this.video.addEventListener("volumechange",this.onVolumeChange.context(this),false);this.video.addEventListener("error",this.onError.context(this),false);this.video.addEventListener("progress",this.onProgress.context(this),false);this.watchBuffer=setInterval(this.updateBufferedTotal.context(this),33);this.video.addEventListener("timeupdate",this.onTimeUpdate.context(this),false);this.playControl.addEventListener("click",this.onPlayControlClick.context(this),false);this.video.addEventListener("click",this.onPlayControlClick.context(this),false);if(this.poster){this.poster.addEventListener("click",this.onPlayControlClick.context(this),false)}this.progressHolder.addEventListener("mousedown",this.onProgressHolderMouseDown.context(this),false);this.progressHolder.addEventListener("mouseup",this.onProgressHolderMouseUp.context(this),false);this.setVolume(localStorage.volume||this.options.defaultVolume);this.volumeControl.addEventListener("mousedown",this.onVolumeControlMouseDown.context(this),false);this.volumeControl.addEventListener("mouseup",this.onVolumeControlMouseUp.context(this),false);this.updateVolumeDisplay();this.fullscreenControl.addEventListener("click",this.onFullscreenControlClick.context(this),false);this.video.addEventListener("mousemove",this.onVideoMouseMove.context(this),false);this.video.addEventListener("mouseout",this.onVideoMouseOut.context(this),false);if(this.poster){this.poster.addEventListener("mousemove",this.onVideoMouseMove.context(this),false)}if(this.poster){this.poster.addEventListener("mouseout",this.onVideoMouseOut.context(this),false)}this.controls.addEventListener("mouseout",this.onVideoMouseOut.context(this),false);this.onEscKey=function(c){if(c.keyCode==27){this.fullscreenOff()}}.context(this);this.onWindowResize=function(c){this.positionController()}.context(this);this.fixPreloading();this.subtitlesSource=this.video.getAttribute("data-subtitles");if(this.subtitlesSource!=null){this.loadSubtitles();this.buildSubtitles()}},fixPreloading:function(){if(typeof this.video.hasAttribute=="function"&&this.video.hasAttribute("preload")){this.video.autobuffer=true}},buildController:function(){this.controls=_V_.createElement("ul",{className:"vjs-controls"});this.video.parentNode.appendChild(this.controls);this.playControl=_V_.createElement("li",{className:"vjs-play-control vjs-play",innerHTML:"<span></span>"});this.controls.appendChild(this.playControl);this.progressControl=_V_.createElement("li",{className:"vjs-progress-control"});this.controls.appendChild(this.progressControl);this.progressHolder=_V_.createElement("ul",{className:"vjs-progress-holder"});this.progressControl.appendChild(this.progressHolder);this.loadProgress=_V_.createElement("li",{className:"vjs-load-progress"});this.progressHolder.appendChild(this.loadProgress);this.playProgress=_V_.createElement("li",{className:"vjs-play-progress"});this.progressHolder.appendChild(this.playProgress);this.timeControl=_V_.createElement("li",{className:"vjs-time-control"});this.controls.appendChild(this.timeControl);this.currentTimeDisplay=_V_.createElement("span",{className:"vjs-current-time-display",innerHTML:"00:00"});this.timeControl.appendChild(this.currentTimeDisplay);this.timeSeparator=_V_.createElement("span",{innerHTML:" / "});this.timeControl.appendChild(this.timeSeparator);this.durationDisplay=_V_.createElement("span",{className:"vjs-duration-display",innerHTML:"00:00"});this.timeControl.appendChild(this.durationDisplay);this.volumeControl=_V_.createElement("li",{className:"vjs-volume-control",innerHTML:"<ul><li></li><li></li><li></li><li></li><li></li><li></li></ul>"});this.controls.appendChild(this.volumeControl);this.volumeDisplay=this.volumeControl.children[0];this.fullscreenControl=_V_.createElement("li",{className:"vjs-fullscreen-control",innerHTML:"<ul><li></li><li></li><li></li><li></li></ul>"});this.controls.appendChild(this.fullscreenControl)},getLinksFallback:function(){return this.box.getElementsByTagName("P")[0]},hideLinksFallback:function(){if(this.options.linksHiding&&this.linksFallback){this.linksFallback.style.display="none"}},getFlashFallback:function(){if(VideoJS.isIE()){return}var c=this.box.getElementsByClassName("vjs-flash-fallback");for(var b=0,a=c.length;b<a;b++){if(c[b].tagName.toUpperCase()=="OBJECT"){return c[b]}}},replaceWithFlash:function(){if(this.flashFallback){this.box.insertBefore(this.flashFallback,this.video);this.video.style.display="none"}},showController:function(){this.controls.style.display="block";this.positionController()},positionController:function(){if(this.controls.style.display=="none"){return}if(this.videoIsFullScreen){this.box.style.width=""}else{this.box.style.width=this.video.offsetWidth+"px"}if(this.options.controlsBelow){if(this.videoIsFullScreen){this.box.style.height="";this.video.style.height=(this.box.offsetHeight-this.controls.offsetHeight)+"px"}else{this.video.style.height="";this.box.style.height=this.video.offsetHeight+this.controls.offsetHeight+"px"}this.controls.style.top=this.video.offsetHeight+"px"}else{this.controls.style.top=(this.video.offsetHeight-this.controls.offsetHeight)+"px"}this.sizeProgressBar()},hideController:function(){if(this.options.controlsHiding){this.controls.style.display="none"}},updatePosterSource:function(){if(!this.video.poster){var a=this.video.getElementsByTagName("img");if(a.length>0){this.video.poster=a[0].src}}},buildPoster:function(){this.updatePosterSource();if(this.video.poster){this.poster=document.createElement("img");this.video.parentNode.appendChild(this.poster);this.poster.src=this.video.poster;this.poster.className="vjs-poster"}else{this.poster=false}},showPoster:function(){if(!this.poster){return}this.poster.style.display="block";this.positionPoster()},positionPoster:function(){if(this.poster==false||this.poster.style.display=="none"){return}this.poster.style.height=this.video.offsetHeight+"px";this.poster.style.width=this.video.offsetWidth+"px"},hidePoster:function(){if(!this.poster){return}this.poster.style.display="none"},canPlaySource:function(){return true},onPlay:function(a){this.playControl.className="vjs-play-control vjs-pause";this.hidePoster();this.trackPlayProgress()},onPause:function(a){this.playControl.className="vjs-play-control vjs-play";this.stopTrackingPlayProgress()},onEnded:function(a){this.video.pause();this.onPause()},onVolumeChange:function(a){this.updateVolumeDisplay()},onError:function(a){console.log(a);console.log(this.video.error)},onLoadedData:function(a){this.showController()},onProgress:function(a){if(a.total>0){this.setLoadProgress(a.loaded/a.total)}},updateBufferedTotal:function(){if(this.video.buffered){if(this.video.buffered.length>=1){this.setLoadProgress(this.video.buffered.end(0)/this.video.duration);if(this.video.buffered.end(0)==this.video.duration){clearInterval(this.watchBuffer)}}}else{clearInterval(this.watchBuffer)}},setLoadProgress:function(a){if(a>this.percentLoaded){this.percentLoaded=a;this.updateLoadProgress()}},updateLoadProgress:function(){if(this.controls.style.display=="none"){return}this.loadProgress.style.width=(this.percentLoaded*(_V_.getComputedStyleValue(this.progressHolder,"width").replace("px","")))+"px"},onPlayControlClick:function(a){if(this.video.paused){this.video.play()}else{this.video.pause()}},onProgressHolderMouseDown:function(a){this.stopTrackingPlayProgress();if(this.video.paused){this.videoWasPlaying=false}else{this.videoWasPlaying=true;this.video.pause()}_V_.blockTextSelection();document.onmousemove=function(b){this.setPlayProgressWithEvent(b)}.context(this);document.onmouseup=function(b){_V_.unblockTextSelection();document.onmousemove=null;document.onmouseup=null;if(this.videoWasPlaying){this.video.play();this.trackPlayProgress()}}.context(this)},onProgressHolderMouseUp:function(a){this.setPlayProgressWithEvent(a);if(this.video.paused){this.onPause()}else{this.onPlay()}},onVolumeControlMouseDown:function(a){_V_.blockTextSelection();document.onmousemove=function(b){this.setVolumeWithEvent(b)}.context(this);document.onmouseup=function(){_V_.unblockTextSelection();document.onmousemove=null;document.onmouseup=null}.context(this)},onVolumeControlMouseUp:function(a){this.setVolumeWithEvent(a)},onFullscreenControlClick:function(a){if(!this.videoIsFullScreen){this.fullscreenOn()}else{this.fullscreenOff()}},onVideoMouseMove:function(a){this.showController();clearInterval(this.mouseMoveTimeout);this.mouseMoveTimeout=setTimeout(function(){this.hideController()}.context(this),4000)},onVideoMouseOut:function(b){var a=b.relatedTarget;while(a&&a!==this.video&&a!==this.controls){a=a.parentNode}if(a!==this.video&&a!==this.controls){this.hideController()}},sizeProgressBar:function(){this.updatePlayProgress();this.updateLoadProgress()},getControlsPadding:function(){return _V_.findPosX(this.playControl)-_V_.findPosX(this.controls)},getControlBorderAdjustment:function(){var a=parseInt(_V_.getComputedStyleValue(this.playControl,"border-left-width").replace("px",""));var b=parseInt(_V_.getComputedStyleValue(this.playControl,"border-right-width").replace("px",""));return a+b},trackPlayProgress:function(){if(this.playProgressInterval){clearInterval(this.playProgressInterval)}this.playProgressInterval=setInterval(function(){this.updatePlayProgress()}.context(this),33)},stopTrackingPlayProgress:function(){clearInterval(this.playProgressInterval)},updatePlayProgress:function(){if(this.controls.style.display=="none"){return}this.playProgress.style.width=((this.video.currentTime/this.video.duration)*(_V_.getComputedStyleValue(this.progressHolder,"width").replace("px","")))+"px";this.updateTimeDisplay()},setPlayProgress:function(a){this.video.currentTime=a*this.video.duration;this.playProgress.style.width=a*(_V_.getComputedStyleValue(this.progressHolder,"width").replace("px",""))+"px";this.updateTimeDisplay();if(this.subtitles!=null){this.currentSubtitlePosition=0}},setPlayProgressWithEvent:function(a){var b=_V_.getRelativePosition(a.pageX,this.progressHolder);this.setPlayProgress(b)},updateTimeDisplay:function(){this.currentTimeDisplay.innerHTML=_V_.formatTime(this.video.currentTime);if(this.video.duration){this.durationDisplay.innerHTML=_V_.formatTime(this.video.duration)}},setVolume:function(a){this.video.volume=parseFloat(a);localStorage.volume=this.video.volume},setVolumeWithEvent:function(a){var b=_V_.getRelativePosition(a.pageX,this.volumeControl.children[0]);this.setVolume(b)},updateVolumeDisplay:function(){var b=Math.ceil(this.video.volume*6);for(var a=0;a<6;a++){if(a<b){_V_.addClass(this.volumeDisplay.children[a],"vjs-volume-level-on")}else{_V_.removeClass(this.volumeDisplay.children[a],"vjs-volume-level-on")}}},fullscreenOn:function(){if(!this.nativeFullscreenOn()){this.videoIsFullScreen=true;this.docOrigOverflow=document.documentElement.style.overflow;document.addEventListener("keydown",this.onEscKey,false);window.addEventListener("resize",this.onWindowResize,false);document.documentElement.style.overflow="hidden";_V_.addClass(this.box,"vjs-fullscreen");this.positionController();this.positionPoster()}},nativeFullscreenOn:function(){if(typeof this.video.webkitEnterFullScreen=="function"&&false){if(!navigator.userAgent.match("Chrome")){this.video.webkitEnterFullScreen();return true}}},fullscreenOff:function(){this.videoIsFullScreen=false;document.removeEventListener("keydown",this.onEscKey,false);window.removeEventListener("resize",this.onWindowResize,false);document.documentElement.style.overflow=this.docOrigOverflow;_V_.removeClass(this.box,"vjs-fullscreen");this.positionController();this.positionPoster()},flashVersionSupported:function(){return VideoJS.getFlashVersion()>=this.options.flashVersion},loadSubtitles:function(){var a=new Request({url:this.subtitlesSource,method:"get",onSuccess:this.parseSubtitles.bind(this),});a.send()},parseSubtitles:function(e){var a=e.replace("\r","").split("\n");this.subtitles=new Array();this.currentSubtitlePosition=0;var c=0;while(c<a.length){var b={};b.id=a[c++];if(b.id==""){break}var d=a[c++].split(" --> ");b.startTime=this.parseSubtitleTime(d[0]);b.endTime=this.parseSubtitleTime(d[1]);var e=new Array();while(a[c].length>0&&a[c]!="\r"){e.push(a[c++])}b.text=e.join("<br/>");this.subtitles.push(b);c++}},parseSubtitleTime:function(a){var c=a.split(":");var b=0;b+=parseInt(c[0])*60*60;b+=parseInt(c[1])*60;var d=c[2].split(",");b+=parseInt(d[0]);b=b+parseInt(d[1])/1000;return b},buildSubtitles:function(){this.subtitlesDiv=_V_.createElement("div",{className:"vjs-subtitles"});this.video.parentNode.appendChild(this.subtitlesDiv)},onTimeUpdate:function(){if(this.subtitles!=null){var a=this.currentSubtitlePosition;while(a<this.subtitles.length&&this.video.currentTime>this.subtitles[a].endTime){if(this.subtitles[a].showing){this.subtitles[a].showing=false;this.subtitlesDiv.innerHTML=""}this.currentSubtitlePosition++;a=this.currentSubtitlePosition}if(this.currentSubtitlePosition>=this.subtitles.length){return}if(this.video.currentTime>=this.subtitles[a].startTime&&this.video.currentTime<=this.subtitles[a].endTime){this.subtitlesDiv.innerHTML=this.subtitles[a].text;this.subtitles[a].showing=true}}}});var _V_={addClass:function(a,b){$(a).addClass(b)},removeClass:function(b,a){$(b).removeClass(a)},merge:function(b,a){return $extend(b,a)},createElement:function(b,a){return _V_.merge(document.createElement(b),a)},blockTextSelection:function(){document.body.focus();document.onselectstart=function(){return false}},unblockTextSelection:function(){document.onselectstart=function(){return true}},formatTime:function(a){a=Math.round(a);minutes=Math.floor(a/60);minutes=(minutes>=10)?minutes:"0"+minutes;a=Math.floor(a%60);a=(a>=10)?a:"0"+a;return minutes+":"+a},getRelativePosition:function(b,a){return Math.max(0,Math.min(1,(b-_V_.findPosX(a))/a.offsetWidth))},findPosX:function(a){var b=a.offsetLeft;while(a=a.offsetParent){b+=a.offsetLeft}return b},getComputedStyleValue:function(a,b){return window.getComputedStyle(a,null).getPropertyValue(b)}};VideoJS.setup=function(b){var d=$$("video");for(var c=0,a=d.length;c<a;c++){videoTag=d[c];if(videoTag.className.indexOf("video-js")!=-1){b=(b)?_V_.merge(b,{num:c}):b;videoJSPlayers[c]=new VideoJS(videoTag,b)}}};VideoJS.addVideos=function(c,a){c=$splat(c);for(var b=0;b<c.length;b++){a=(a)?_V_.merge(a,{num:videoJSPlayers.length}):a;videoJSPlayers.push(new VideoJS(c[b],a))}};VideoJS.browserSupportsVideo=function(){if(typeof VideoJS.videoSupport!="undefined"){return VideoJS.videoSupport}return VideoJS.videoSupport=!!document.createElement("video").canPlayType};VideoJS.getFlashVersion=$lambda(Browser.Plugins.Flash.version);VideoJS.isIE=function(){return !+"\v1"};VideoJS.isIpad=function(){return navigator.userAgent.match(/iPad/i)!=null};Function.prototype.context=Function.prototype.bind;